// Get these from Supabase
const supabaseUrl = "https://gygemacnzxhdokneotjt.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5Z2VtYWNuenhoZG9rbmVvdGp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM0NDE3MTEsImV4cCI6MjA1OTAxNzcxMX0.w41DchhFlk03FOl_rP28hUtaloHtHL7scwzjHJMUkJk";

const supabase = createClient(supabaseUrl, supabaseKey);

async function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    const { error } = await supabase.auth.signInWithPassword({
        email: email,
        password: password
    });

    if (!error) {
        document.getElementById('login').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        loadRecords();
    }
}

async function uploadPhoto() {
    const file = document.getElementById('timesheetPhoto').files[0];
    const description = document.getElementById('description').value;

    const { data } = await supabase.storage
        .from('timesheets')
        .upload(file.name, file);

    if (data) {
        await supabase.from('timesheets').insert([{ 
            image_url: data.path, 
            description: description 
        }]);
        loadRecords();
    }
}

async function loadRecords() {
    const { data } = await supabase.from('timesheets').select('*');
    let html = '';
    data.forEach(record => {
        html += `
            <div>
                <img src="${supabaseUrl}/storage/v1/object/public/timesheets/${record.image_url}">
                <p>${record.description}</p>
            </div>
        `;
    });
    document.getElementById('records').innerHTML = html;
}